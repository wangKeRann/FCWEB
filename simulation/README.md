# 视频流模拟器

这是一个用于模拟无人机和机械狗视频流的工具，可以同时发送多个视频流到服务器。

## 功能特点

1. 支持多种视频流：
   - 无人机普通视频
   - 无人机热成像视频
   - 机械狗普通视频
   - 机械狗热成像视频

2. 视频流控制：
   - 可以独立控制每个视频流的启用/禁用
   - 默认配置可以修改

3. 数据传输：
   - 使用 WebSocket 协议
   - 支持自动重连
   - 实时 FPS 监控
   - JPEG 格式压缩传输

4. 错误处理：
   - 连接失败自动重试
   - 详细的错误日志
   - 优雅的资源释放

## 安装要求

1. Python 3.8 或更高版本
2. 依赖包：
   ```
   websockets==11.0.3
   opencv-python==4.8.0.76
   numpy==1.24.3
   aiohttp==3.8.5
   python-dotenv==1.0.0
   ```

## 使用方法

1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 准备视频文件：
   - 将视频文件放入 `video` 目录
   - 支持的文件：
     - `drone_video.mp4`：无人机普通视频
     - `drone_infrared.mp4`：无人机热成像视频
     - `dog_video.mp4`：机械狗普通视频
     - `dog_infrared.mp4`：机械狗热成像视频

3. 配置视频流：
   - 在 `video_simulator.py` 中修改 `all_video_configs` 配置
   - 通过 `enabled` 参数控制每个视频流的启用/禁用
   ```python
   {
       "device_type": "drone",
       "video_type": "regular",
       "video_path": "video/drone_video.mp4",
       "enabled": True  # True 表示启用，False 表示禁用
   }
   ```

4. 运行程序：
   ```bash
   python video_simulator.py
   ```

## 配置说明

### 视频流配置
每个视频流配置包含以下参数：
- `device_type`：设备类型（"drone" 或 "robot"）
- `video_type`：视频类型（"regular" 或 "infrared"）
- `video_path`：视频文件路径
- `enabled`：是否启用该视频流

### 默认配置
- 无人机普通视频：启用
- 无人机热成像视频：启用
- 机械狗普通视频：启用
- 机械狗热成像视频：启用

## 日志说明

程序会输出以下类型的日志：
- INFO：常规信息（连接成功、开始传输等）
- DEBUG：详细调试信息（帧编码、发送状态等）
- WARNING：警告信息（文件不存在、连接失败等）
- ERROR：错误信息（编码失败、发送失败等）

## 性能监控

程序会实时显示：
- 每个视频流的 FPS（每秒帧数）
- 数据传输状态
- 连接状态

## 注意事项

1. 确保视频文件存在且格式正确
2. 确保服务器地址正确（默认：ws://172.22.132.3:8000/ws/video）
3. 网络连接不稳定时，程序会自动重试
4. 视频流会自动循环播放

## 常见问题

1. 连接被拒绝：
   - 检查服务器是否运行
   - 检查服务器地址是否正确
   - 检查网络连接

2. 视频文件找不到：
   - 检查文件路径是否正确
   - 检查文件名是否正确
   - 检查文件权限

3. 帧率过低：
   - 检查网络带宽
   - 调整 JPEG 压缩质量
   - 检查服务器处理能力 